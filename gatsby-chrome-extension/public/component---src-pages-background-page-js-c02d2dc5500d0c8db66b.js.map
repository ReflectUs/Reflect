{"version":3,"sources":["webpack:///./src/components/background4.js","webpack:///./src/pages/backgroundPage.js"],"names":["userID","photoURL","name","websites","email","WebsiteItem","url","tabID","oTime","this","website","getWebsiteFromUrl","totalTime","printWebsites","console","log","i","length","print","updateWebsiteItem","newTabID","chrome","tabs","query","temp","Date","alreadyExists","isActive","clearID","equals","setID","push","prototype","posStart","indexOf","offSetStart","posEnd","substring","isID","tabIDs","time","isWebsite","currTime","Math","round","firebase","database","ref","set","writeWebsiteData","websiteItemOther","runtime","onInstalled","addListener","contextMenus","create","onActivated","tabDetails","tabId","onRemoved","removeInfo","onCreated","tab","id","onUpdated","changeInfo","initializeApp","apiKey","databaseURL","storageBucket","initApp","auth","onAuthStateChanged","user","displayName","uid","created_at","metadata","creationTime","replace","toLowerCase","floor","random","once","snapshot","val","update","email_address","username","createUser","window","onload","BackgroundPage","href"],"mappings":"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","file":"component---src-pages-background-page-js-c02d2dc5500d0c8db66b.js","sourcesContent":["\nvar websites = [];\nvar email = \"\";\nvar userID;\nvar displayName;\nvar photoURL;\nvar name;\n\nWebsiteItem.prototype.getWebsiteFromUrl = function(url) {\n  var posStart = url.indexOf(\"www.\");\n  var offSetStart = 4;\n  if(posStart == -1) {\n    posStart = url.indexOf(\"://\");\n    offSetStart = 3;\n  }\n  var posEnd = url.indexOf(\".\", posStart + offSetStart);\n  var website = \"\";\n  if(posStart != -1 && posEnd != -1) {\n    website = url.substring(posStart+offSetStart, posEnd);\n  }\n  return website;\n};\n\nfunction WebsiteItem(url, tabID, oTime) {\n    this.website = this.getWebsiteFromUrl(url);\n    this.tabID = tabID\n    this.oTime = oTime;\n    this.totalTime = 0;\n}\n\nWebsiteItem.prototype.isID = function(tabID) {\n  if(this.tabIDs == tabID) {\n    return true;\n  }\n  return false;\n};\n\nWebsiteItem.prototype.setID = function(tabID, time) {\n  if(!tabID) {\n    return;\n  } else {\n    this.tabID = tabID;\n    this.oTime = time;\n  }\n};\n\nWebsiteItem.prototype.isWebsite = function(url) {\n  if(this.website == this.getWebsiteFromUrl(url)) {\n    return true;\n  } else {\n    return false;\n  }\n};\n\nWebsiteItem.prototype.clearID = function(currTime) {\n  this.totalTime += Math.round((currTime - this.oTime)/1000.0);\n  this.oTime = -1;\n  this.tabID = -1;\n  if(this.website != \"\") {\n    writeWebsiteData(userID, this.website, this.totalTime);\n  }\n};\n\nWebsiteItem.prototype.equals = function(websiteItemOther) {\n  if (this.website == websiteItemOther.website) {\n    return true;\n  }\n  return false;\n};\n\nWebsiteItem.prototype.print = function() {\n  console.log(this.website + \" ||\\t\" + this.tabID + \" |\\t\" + this.totalTime);\n};\n\nWebsiteItem.prototype.isActive = function() {\n  return this.tabID != -1;\n};\n\n\n\n// WebsiteItem definition ends\n///////////////////////////______________________________________////////////////////////////\n// Event Listeners begin\n\n\n\n\n\nchrome.runtime.onInstalled.addListener(function() {\n   chrome.contextMenus.create({\n     \"id\": \"sampleContextMenu\",\n     \"title\": \"Sample Context Menu\",\n     \"contexts\": [\"selection\"]\n   });\n});\n\nfunction printWebsites() {\n  console.log(\"/////////////////////\");\n  console.log(\"\");\n  console.log(\"/////////////////////\");\n  for(var i = 0; i < websites.length; i++) {\n    websites[i].print();\n  }\n}\n\nfunction updateWebsiteItem(newTabID) {\n  chrome.tabs.query({'active': true, 'lastFocusedWindow': true}, function (tabs) {\n    var url = tabs[0].url;\n    var temp = new WebsiteItem(url, newTabID, new Date());\n    var alreadyExists = false;\n    for(var i = 0; i < websites.length; i++) {\n      if(websites[i].isActive()) {\n        websites[i].clearID(new Date()); // old tabID = -1, old oTime = -1, old totalTime += time\n      }\n      if(websites[i].equals(temp)) {\n        websites[i].setID(newTabID, new Date()); // oTime = currTime, tabID = currTabID\n        alreadyExists = true;\n      }\n    }\n    if(!alreadyExists) {\n      websites.push(temp);\n    }\n    printWebsites();\n  });\n}\n\n\nchrome.tabs.onActivated.addListener(function(tabDetails) {\n  // tabDetails is an object\n  updateWebsiteItem(tabDetails.tabId);\n\n});\n\nchrome.tabs.onRemoved.addListener(function(tabID, removeInfo) {\n  for(var i = 0; i < websites.length; i++) {\n    if(websites[i].isID(tabID)) {\n      websites[i].clearID(new Date()); // old tabID = -1, old oTime = -1, old totalTime += time\n    }\n  }\n  printWebsites();\n\n});\n\nchrome.tabs.onCreated.addListener(function(tab) {\n  // var temp = new WebsiteItem(tab.url, tab.id, new Date());\n  // console.log(tab);\n  var temp = new WebsiteItem(tab.url, tab.id, new Date());\n  var alreadyExists = false;\n  for(var i = 0; i < websites.length; i++) {\n    if(websites[i].equals(temp)) {\n      websites[i].setID(tab.id, new Date());\n      alreadyExists = true;\n    }\n  }\n  if(!alreadyExists) {\n    websites.push(temp);\n  }\n  printWebsites();\n});\n\nchrome.tabs.onUpdated.addListener(function(tabID, changeInfo, tab) {\n  updateWebsiteItem(tab.id);\n});\n\n\n\n\n\n//////// Writing Data Firebase /////////\n\n// function writeUserData(userID, name, email, photoURL) {\n//   firebase.database().ref('users/' + userID).set({\n//     email: email,\n//     photoURL: photoURL,\n//     name: name\n//   });\n// }\n\nfunction writeWebsiteData(userID, website, time) {\n  firebase.database().ref('chrome/' + userID + '/websiteTime/' + website).set({\n    time: time\n  })\n}\n\nfunction createUser(userID, name, email, photoURL, created_at) {\n  let id = name.replace(/ .*/, \"\");\n  id = id.toLowerCase() + Math.floor(Math.random() * 90000);\n  firebase.database()\n    .ref(\"users/\" + userID)\n    .once(\"value\", function(snapshot) {\n      var exists = snapshot.val() !== null;\n      if(exists) {\n        firebase.database().ref('users/' + userID).update({\n          photoURL: photoURL\n        });\n      } else {\n        firebase.database().ref('users/' + userID).set({\n          created_at: created_at,\n          email_address: email,\n          id: id,\n          username: name,\n          photoURL: photoURL\n        });\n      }\n    });\n}\n\n\n\n///////////////////////// Firebase OAuth Stuff /////////////////////////\n\n// using Reflectme database\nvar config = {\n  apiKey: 'AIzaSyAXLZRCJb7YTB-l6yqJAGZGOaIn9zSDPJQ',\n  databaseURL: 'https://reflect-me-mhacks.firebaseio.com',\n  storageBucket: 'reflect-me-mhacks.appspot.com'\n};\nfirebase.initializeApp(config);\nvar db = firebase.database();\n\n\nfunction initApp() {\n  // Listen for auth state changes.\n  firebase.auth().onAuthStateChanged(function(user) {\n    console.log('User state change detected from the Background script of the Chrome Extension:', user);\n    name = user.displayName;\n    email = user.email;\n    photoURL = user.photoURL;\n    userID = user.uid;\n    created_at = user.metadata.creationTime;\n    createUser(userID, name, email, photoURL, created_at);\n  });\n}\n\nwindow.onload = function() {\n  initApp();\n};\n","/* global chrome */\nimport React from \"react\"\nimport { Link } from \"gatsby\"\n\nimport Layout from \"../components/layout\"\nimport Image from \"../components/image\"\nimport SEO from \"../components/seo\"\nimport \"../components/background4.js\"\n\nconst BackgroundPage = () => (\n  <Layout>\n    <script href=\"./background4.js\"/>\n  </Layout>\n)\n\nexport default BackgroundPage\n"],"sourceRoot":""}